<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HospiSuite Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <style>
        body {
            background: linear-gradient(135deg, #b5b5b5 0%, #d9ece5 100%);
            min-height: 100vh;
            padding: 20px 10px; /* Base padding for smaller screens */
        }
       /* Banner styling */
.form-container {
    max-width: 1000px; /* Increased max-width to make the banner larger */
}
.banner-image {
    width: 100%;
    height: auto; /* Maintain aspect ratio */
    border-radius: 20px; /* Ample border-radius for a rounded look */
    box-shadow: 0 18px 16px rgba(0, 0, 0, 0.15); /* Box shadow for depth */
}
/* Ensure the banner remains responsive on smaller screens */
@media (max-width: 576px) {
    .banner-image {
        border-radius: 15px; /* Slightly smaller border-radius on mobile */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Lighter shadow on mobile */
    }
    .form-container {
        max-width: 100%; /* Full width on mobile for better fit */
    }
}
        .form-section {
            background: #ffffff;
            border-left: 5px solid #222323c2;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        .form-section-valid {
            border-left-color: #7ab8a6;
        }
        .form-label {
            color: #2e5e54;
            font-weight: 500;
        }
        .form-control, .form-select {
            border-color: #b8d8cc;
            transition: all 0.3s ease;
        }
        .form-control:focus, .form-select:focus {
            border-color: #7ab8a6;
            box-shadow: 0 0 5px rgba(122, 184, 166, 0.5);
        }
        .form-check-input:checked {
            background-color: #7ab8a6;
            border-color: #7ab8a6;
        }
        .btn-success {
            background-color: #7ab8a6;
            border-color: #7ab8a6;
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            background-color: #619d8c;
            border-color: #619d8c;
            transform: translateY(-2px);
        }
        #otherProfessionField {
            display: none;
        }
        /* Styling for select elements */
        .form-select {
            width: 100%;
            padding: 0.375rem 1.75rem 0.375rem 0.75rem;
            font-size: 1rem;
            border-bottom: 2px solid #7ab8a6;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        /* Responsive adjustments for smaller screens */
        @media (max-width: 576px) {
            .form-select {
                font-size: 0.875rem;
                padding: 0.25rem 1.5rem 0.25rem 0.5rem;
            }
            .form-section {
                padding: 15px;
            }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        label {
            font-weight: 500;
            margin-bottom: 10px;
            font-size: 14px;
            font-style: italic;
        }
        .btn-black {
            background-color: #000;
            color: #FFF;
            margin-block: 3%;
        }
        
        .btn-black:hover {
            color: #FFF;
        }
        input::placeholder {
            color: gray; /* Change placeholder text color */
            font-size: 12px; /* Adjust font size */
            font-style: italic; /* Make it italic */
            opacity: .7; /* Ensure it's fully visible */
          }
        
        /* Styling for select elements */
.form-select {
    width: 100%;
    padding: 0.75rem 1.75rem 0.75rem 0.75rem; /* Increased vertical padding to make the select taller */
    font-size: 1.2rem;
    line-height: 1.5; /* Ensure text is vertically centered */
    border-bottom: 2px solid #343434a6;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Responsive adjustments for smaller screens */
@media (max-width: 576px) {
    .form-select {
        font-size: 0.875rem;
        padding: 0.5rem 1.5rem 0.5rem 0.5rem; /* Slightly increased padding on mobile */
    }
}
    </style>
</head>
<body>
    <div class="container form-container">
        <!-- Banner Section -->
        <div class="row mb-4">
            <div class="col-12">
                <img src="./docreg.svg" alt="HospiSuite Doctor Registration Banner" class="img-fluid banner-image" style="width: 100%; height: auto;">
            </div>
        </div>
        <!-- Form Section -->
        <form>
            <div class="form-section"data-aos="fade-down">
                <label for="email" class="form-label">Email </label> <b style="color: red;">&nbsp *</b><br>
                <label for="description"> <small>You'll receive important updates and notifications at this email</small></label>
                <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
            </div>

            <div class="form-section"data-aos="fade-down">
                <label for="fullName" class="form-label">Full Name </label><b style="color: red;">&nbsp *</b><br>
                <label for="description"> <small>As per your official records</small></label>
                <input type="text" class="form-control" id="fullName" placeholder="Enter fullname" required>
            </div>

            <div class="form-section" data-aos="fade-down" >
                <label class="form-label">Gender </label><b style="color: red;">&nbsp *</b>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="genderMale" value="male" required>
                    <label class="form-check-label" for="genderMale">Male</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="female">
                    <label class="form-check-label" for="genderFemale">Female</label>
                </div>
            </div>

            <div class="form-section" data-aos="fade-up">
                <label for="dob" class="form-label">Date of Birth <b style="color: red;">&nbsp *</b></label>
                <input type="date" class="form-control" id="dob" min="1960-01-01" max=""required>
            </div>

            <div class="form-section" data-aos="fade-up">
                <label for="mobile" class="form-label">Mobile Number</label><b style="color: red;">&nbsp *</b><br>
                <label for="description"> <small>You will receive online consultation links via this number (preferably WhatsApp)</small></label>
                <input type="tel" class="form-control" id="mobile" placeholder="Phone Number" required>
            </div>

            <div class="form-section" data-aos="fade-up">
                <label for="state" class="form-label">State </label><b style="color: red;">&nbsp *</b><br>
                <label for="description"> <small>Your current residing State</small></label>
                <select class="form-select" id="state" required>
                    <option value="">Please select</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                    <option value="Chandigarh">Chandigarh</option>
                    <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                    <option value="Ladakh">Ladakh</option>
                    <option value="Lakshadweep">Lakshadweep</option>
                    <option value="Puducherry">Puducherry</option>
                </select>
            </div>

            <div class="form-section" data-aos="fade-up">
                <label for="medRegNum" class="form-label">Medical Registration Number </label><b style="color: red;">&nbsp*</b><br>
                <label for="description"> <small>As per the Indian Medical Registry/State Medical Council</small></label>
                <input type="text" class="form-control" id="medRegNum" required>
            </div>

            <div class="form-section" data-aos="fade-up">
                <label for="yearReg" class="form-label">Year of Registration (YOR) </label><b style="color: red;">&nbsp *</b>
                <label for="description"> <small>Most recent <b>YOR</b> in case of multiple registrations</small></label>
                <select class="form-select" id="yearReg" required>
                    <option value="">Please select</option>
                </select>
            </div>

            <div class="form-section" data-aos="fade-up">
                <label for="fieldPractice" class="form-label">Field of Practice </label><b style="color: red;">&nbsp *</b>
                <select class="form-select" id="fieldPractice" required>
                    <option value="">Please select</option>
                    <option value="allopathy">Allopathy (MBBS, MD, MS, etc.)</option>
                    <option value="ayush">AYUSH</option>
                    <option value="therapeutic">Therapeutic</option>
                    <option value="mental">Mental Health & Counseling</option>
                    <option value="nutrition">Nutrition/Dietetics</option>
                    <option value="ayurveda">Ayurveda</option>
                    <option value="homeopathy">Homeopathy</option>
                    <option value="other">Other</option>
                </select>
                <div id="otherProfessionField" class="mt-3">
                    <label for="otherProfession" class="form-label">Please specify your profession </label><b style="color: red;">&nbsp *</b>
                    <input type="text" class="form-control" id="otherProfession">
                </div>
            </div>

            <div class="form-section" data-aos="fade-up">
                <label for="yearsExp" class="form-label">Years of Experience <b style="color: red;">&nbsp *</b></label>
                <select class="form-select" id="yearsExp" required>
                    <option value="">Please select</option>
                    <option value="less than 1">Less than 1 year</option>
                    <option value="1-3">1 - 3 years</option>
                    <option value="3-5">3 - 5 years</option>
                    <option value="5-10">5 - 10 years</option>
                    <option value="10+">10+ years</option>
                </select>
            </div>

            <button type="submit" class="submit btn btn-black w-100">Submit</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        AOS.init({
            // Global settings:
            disable: false, // accepts following values: 'phone', 'tablet', 'mobile', boolean, expression or function
            startEvent: 'DOMContentLoaded', // name of the event dispatched on the document, that AOS should initialize on
            initClassName: 'aos-init', // class applied after initialization
            animatedClassName: 'aos-animate', // class applied on animation
            useClassNames: false, // if true, will add content of `data-aos` as classes on scroll
            disableMutationObserver: false, // disables automatic mutations' detections (advanced)
            debounceDelay: 50, // the delay on debounce used while resizing window (advanced)
            throttleDelay: 99, // the delay on throttle used while scrolling the page (advanced)
            
          
            // Settings that can be overridden on per-element basis, by `data-aos-*` attributes:
            offset: 80, // offset (in px) from the original trigger point
            delay: 0, // values from 0 to 3000, with step 50ms
            duration: 600, // values from 0 to 3000, with step 50ms
            easing: 'ease', // default easing for AOS animations
            once: false, // whether animation should happen only once - while scrolling down
            mirror: true, // whether elements should animate out while scrolling past them
            anchorPlacement: 'top-bottom', // defines which position of the element regarding to window should trigger the animation
          
          });
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Set max date for DOB to today
            const dobInput = document.getElementById('dob');
            const today = new Date().toISOString().split('T')[0];
            if (dobInput) {
                dobInput.setAttribute('max', today);
            } else {
                console.error('Element with ID "dob" not found in the DOM.');
            }
    
            // Show/hide "Other" profession field based on selection
            document.getElementById('fieldPractice').addEventListener('change', function() {
                const otherField = document.getElementById('otherProfessionField');
                const otherInput = document.getElementById('otherProfession');
                if (this.value === 'other') {
                    otherField.style.display = 'block';
                    otherInput.setAttribute('required', 'required');
                } else {
                    otherField.style.display = 'none';
                    otherInput.removeAttribute('required');
                    otherInput.value = ''; // Clear the input when "Other" is not selected
                    validateField(otherInput); // Re-validate the "Other Profession" field
                }
                validateField(this); // Validate the "Field of Practice" select
            });
    
            // Populate Year of Registration dropdown (1970 to current year)
            const yearSelect = document.getElementById('yearReg');
            const currentYear = new Date().getFullYear();
            for (let year = 1970; year <= currentYear; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
    
            // Function to validate a field and update the parent form-section
            function validateField(field) {
                const formSection = field.closest('.form-section');
                let isValid = false;
    
                if (field.tagName === 'INPUT') {
                    if (field.type === 'email') {
                        // Basic email validation
                        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        isValid = emailPattern.test(field.value);
                    } else if (field.type === 'tel') {
                        // Basic phone number validation (e.g., at least 10 digits)
                        const phonePattern = /^\d{10,}$/;
                        isValid = phonePattern.test(field.value);
                    } else if (field.type === 'date') {
                        // Check if a date is selected
                        isValid = field.value !== '';
                    } else {
                        // For text inputs (e.g., fullName, medRegNum)
                        isValid = field.value.trim() !== '';
                    }
                } else if (field.tagName === 'SELECT') {
                    // For select elements, check if a non-empty option is selected
                    isValid = field.value !== '';
                }
    
                // Toggle the .form-section-valid class based on validation
                if (isValid) {
                    formSection.classList.add('form-section-valid');
                } else {
                    formSection.classList.remove('form-section-valid');
                }
            }
    
            // Special validation for radio buttons (Gender)
            function validateRadioButtons(name) {
                const radios = document.querySelectorAll(`input[name="${name}"]`);
                const formSection = radios[0].closest('.form-section');
                const isChecked = Array.from(radios).some(radio => radio.checked);
    
                if (isChecked) {
                    formSection.classList.add('form-section-valid');
                } else {
                    formSection.classList.remove('form-section-valid');
                }
            }
    
            // Add event listeners to all inputs and selects
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    input.addEventListener('change', () => validateRadioButtons(input.name));
                } else {
                    // Use 'input' event for real-time validation, 'change' for selects
                    input.addEventListener('input', () => validateField(input));
                    input.addEventListener('change', () => validateField(input));
                    input.addEventListener('blur', () => validateField(input));
                }
            });
    
            // Form submission and encryption logic
            document.querySelector('form').addEventListener('submit', async (e) => {
                e.preventDefault();
                let query = window.location.search.substring(1);
                let userNumber = query.replace(/^q=/, "");
                console.log(userNumber);
    
                const dobInput = document.getElementById('dob').value;
                const dobDate = new Date(dobInput);
                const formattedDob = `${String(dobDate.getDate()).padStart(2, '0')}/${String(dobDate.getMonth() + 1).padStart(2, '0')}/${dobDate.getFullYear()}`;
    
                // Get the fieldPractice value and append the "Other Profession" if applicable
                let fieldPracticeValue = document.getElementById('fieldPractice').value;
                const otherProfessionValue = document.getElementById('otherProfession').value.trim();
                if (fieldPracticeValue === 'other' && otherProfessionValue) {
                    fieldPracticeValue = `${otherProfessionValue}`; // Use only the "Other Profession" value
                }
    
                const formData = {
                    email: document.getElementById('email').value,
                    fullName: document.getElementById('fullName').value,
                    gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                    dob: formattedDob,
                    mobile: document.getElementById('mobile').value,
                    state: document.getElementById('state').value,
                    medRegNum: document.getElementById('medRegNum').value,
                    yearReg: document.getElementById('yearReg').value,
                    fieldPractice: fieldPracticeValue,
                    yearsExp: document.getElementById('yearsExp').value,
                    waNumber: userNumber
                };
    
                if (!dobInput) {
                    alert('Please select a valid Date of Birth.');
                    return;
                }
    
                console.log('Form Data:', formData);
    
                try {
                    const data = JSON.stringify(formData);
                    const encoder = new TextEncoder();
                    const key = await crypto.subtle.generateKey(
                        { name: 'AES-GCM', length: 256 },
                        true,
                        ['encrypt', 'decrypt']
                    );
                    console.log('Generated Key:', key);
    
                    const iv = crypto.getRandomValues(new Uint8Array(12));
                    const encryptData = await crypto.subtle.encrypt(
                        { name: 'AES-GCM', iv: iv },
                        key,
                        encoder.encode(data)
                    );
    
                    const exported = await crypto.subtle.exportKey('jwk', key);
                    console.log('Exported Key:', exported);
    
                    const encryptedArray = new Uint8Array(encryptData);
                    const cipherText = encryptedArray.slice(0, -16);
                    const tag = encryptedArray.slice(-16);
    
                    const payload = {
                        encryptData: arrayBufferToBase64(cipherText),
                        tag: arrayBufferToBase64(tag),
                        iv: arrayBufferToBase64(iv),
                        exportedKey: JSON.stringify(exported)
                    };
                    console.log('\n\nPayload generated:', payload);
    
                    fetch('https://d2u4fyx6ods8mm.cloudfront.net/registration/auth/', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json',
                        }
                    })
                        .then(response => response.json())
                        .then(token => {
                            console.log('Auth Token Received:', token);
                            console.log('Sending data to server');
                            fetch('https://d2u4fyx6ods8mm.cloudfront.net/registration/submit', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json',
                                    'Authorization': token, 
                                },
                                body: JSON.stringify({
                                    data: payload,
                                }),
                            })
                                .then(response => response.json())
                                .then(data => {
                                    console.log('Success:', data);
                                    console.log('Message:', data.msg);
                                    console.log('Status:', data.status);
                                    //success message show 
                                    if(data.msg === "Duplicate Data"){
                                        alert('You have already registered with this email id');
                                        document.querySelector('form').reset();
                                           // redirect to hospisuite whats app bot 
                                        // Delay the redirection by 2 seconds (2000 milliseconds)
                                        setTimeout(() => {
                                            // Create an invisible link and trigger a click
                                           let link = document.createElement("a");
                                           link.href = "https://wa.me/918415082512";
                                           link.target = "_blank"; // Opens in a new tab
                                           document.body.appendChild(link);
                                           link.click();
                                            document.body.removeChild(link); // Clean up the DOM
                                        }, 1000);
                                        return;
                                    }else if(data.msg === "Form submitted successfully"){
                                        alert('Register Success!!\nThank you for registering with Hospisuite.\n\nRedirecting to Hospisuite WhatsApp Bot');
                                        document.querySelector('form').reset();
                                        // redirect to hospisuite whats app bot 
                                        // Delay the redirection by 2 seconds (2000 milliseconds)
                                         setTimeout(() => {
                                           // Create an invisible link and trigger a click
                                          let link = document.createElement("a");
                                          link.href = "https://wa.me/918415082512";
                                          link.target = "_blank"; // Opens in a new tab
                                          document.body.appendChild(link);
                                          link.click();
                                           document.body.removeChild(link); // Clean up the DOM
                                       }, 1000);
                                    }else {
                                        alert('Form submission failed. Please try again.');
                                        document.querySelector('form').reset();
                                           // redirect to hospisuite whats app bot 
                                        // Delay the redirection by 2 seconds (2000 milliseconds)
                                        setTimeout(() => {
                                            // Create an invisible link and trigger a click
                                           let link = document.createElement("a");
                                           link.href = "https://wa.me/918415082512";
                                           link.target = "_blank"; // Opens in a new tab
                                           document.body.appendChild(link);
                                           link.click();
                                            document.body.removeChild(link); // Clean up the DOM
                                        }, 1000);
                                    }
                                  
                                })
                                .catch(error => {
                                    console.error('Error sending data:', error);
                                });
                        })
                        .catch(error => {
                            console.error('Error fetching token:', error);
                        });
                } catch (error) {
                    console.error('Encryption error:', error);
                }
            });
    
            function arrayBufferToBase64(buffer) {
                return btoa(String.fromCharCode(...new Uint8Array(buffer)));
            }
        });
    </script>  
</body>
</html>